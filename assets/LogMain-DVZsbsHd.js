import{a as W,g as Z}from"./index-b2oChmgr.js";import{g as ee,a as le}from"./index-D9knF54_.js";import{u as ae}from"./vue-router-Bu4PTcIf.js";import{t as O}from"./dateUtil-NlCD2qvi.js";import{u as te}from"./index-B4tlj57P.js";import{_ as ue}from"./index-B7IN_rDP.js";import{E as oe}from"./element-plus-CB4diBvn.js";import{r as c,b as re,X as ne,c as E,a as g,Q as l,I as t,P as J,ag as n,o as k,M as V,a4 as de,H as me,O as w,u as ie}from"./@vue-DJGElsCt.js";import"./axios-upsvKRUO.js";import"./nprogress-vyVW41Zc.js";import"./dayjs-DUzyJfMy.js";import"./arktourosUiConfigUtil-DM9bp1OR.js";import"./pinia-C1gkOLtH.js";import"./@element-plus-dQIYR_U6.js";import"./pinia-plugin-persistedstate-BlIkimV0.js";import"./destr-Cx7WjB9q.js";import"./deep-pick-omit-B1UrSIxj.js";import"./lodash-es-BKnOc8U_.js";import"./@popperjs-Bm-vPkQ2.js";import"./@ctrl-CBTFr1m8.js";import"./async-validator-DBBz-maN.js";import"./memoize-one-DxrTgWdQ.js";import"./normalize-wheel-es-Cg1Do7zv.js";import"./@floating-ui-BPK96wVr.js";const se={class:"log-main-container"},pe={class:"search-area"},ce={class:"pagination-div"},ve={__name:"LogMain",setup(ge){const A=te(),L=ae(),z=c(0),S=c([]),_=c(),b=c(0),y=c(0),o=c({pageNum:1,pageSize:10,serviceName:"",traceId:"",keyword:"",keywordNotIncluded:"",severityText:"",startTimestamp:0,endTimestamp:0}),h=async()=>{const u=JSON.parse(JSON.stringify(o.value));b.value!==0&&y.value!==0?(u.startTimestamp=b.value,u.endTimestamp=y.value):(u.startTimestamp=null,u.endTimestamp=null);const e=await ee(u);e!==null&&(z.value=parseInt(e.result.total),e.result.data.forEach(d=>{d.serviceName||(d.serviceName="null")}),S.value=e.result.data)},$=async u=>{o.value.pageSize=u,await h()},M=async u=>{o.value.pageNum=u,await h()},P=async(u,e)=>{const d=await le(u);if(d===null){e([]);return}const v=d.result.map(s=>s?{value:s}:{value:"null"});e(v)};re(async()=>{await h()});const I=c(!1),r=c({}),j=u=>{const e=JSON.parse(JSON.stringify(u));r.value=e,r.value.timestamp=O(e.timestamp),r.value.error=e.error?"\u5F02\u5E38":"\u6B63\u5E38",r.value.tags=e.tags.map(d=>d.key+"->"+d.value).join(`
`),I.value=!0},q=async u=>{if(!u.serviceName||!u.traceId){oe.warning("\u8BE5\u65E5\u5FD7\u672A\u4E0A\u62A5\u94FE\u8DEF\u4FE1\u606F");return}A.$patch(e=>{e.currentAside.active="/main/trace"}),await L.push(`/main/trace?serviceName=${u.serviceName}&traceId=${u.traceId}`)},F=ne({lazy:!0,async lazyLoad(u,e){const d=[],{level:v}=u;if(v===0){const s=await W();if(s===null)return;s.result.map(i=>({leaf:!1,value:i,label:i})).forEach(i=>{d.push(i)})}else if(v===1){const s=await Z({query:"",namespace:u.value,pageNum:1,pageSize:1e3});if(s===null)return;s.result.data.map(i=>({leaf:!0,value:i.name,label:i.name===""?"null":i.name})).forEach(i=>{d.push(i)})}e(d)}}),H=()=>{_.value?(o.value.serviceName=_.value[1],(o.value.serviceName===""||o.value.serviceName==null)&&(o.value.serviceName="null")):o.value.serviceName=null};return(u,e)=>{const d=n("el-breadcrumb-item"),v=n("el-breadcrumb"),s=n("el-row"),i=n("el-cascader"),m=n("el-form-item"),p=n("el-input"),T=n("el-input-number"),N=n("el-tooltip"),Q=n("el-autocomplete"),U=n("el-button"),x=n("el-form"),R=n("el-divider"),f=n("el-col"),X=n("Share"),C=n("el-icon"),Y=n("InfoFilled"),B=n("el-pagination"),D=n("el-card"),G=n("el-dialog");return k(),E(J,null,[g("div",se,[l(s,null,{default:t(()=>[l(v,{"separator-icon":"ArrowRight"},{default:t(()=>[l(d,null,{default:t(()=>e[18]||(e[18]=[g("a",{href:"/main"},"\u4E3B\u9875",-1)])),_:1}),l(d,null,{default:t(()=>e[19]||(e[19]=[g("a",{href:"/main/log"},"\u65E5\u5FD7\u6982\u89C8",-1)])),_:1})]),_:1})]),_:1}),l(D,{class:"log-card"},{default:t(()=>[g("div",pe,[l(x,{inline:!0,model:o.value},{default:t(()=>[l(m,{label:"\u670D\u52A1\u540D\u79F0"},{default:t(()=>[l(i,{placeholder:"\u8BF7\u9009\u62E9\u547D\u540D\u7A7A\u95F4\u2192\u670D\u52A1\u540D\u79F0",modelValue:_.value,"onUpdate:modelValue":e[0]||(e[0]=a=>_.value=a),clearable:"",props:F,"show-all-levels":!1,onChange:H},null,8,["modelValue","props"])]),_:1}),l(m,{label:"traceId"},{default:t(()=>[l(p,{modelValue:o.value.traceId,"onUpdate:modelValue":e[1]||(e[1]=a=>o.value.traceId=a),placeholder:"\u8BF7\u8F93\u5165\u4E00\u4E2AtraceId",clearable:""},null,8,["modelValue"])]),_:1}),l(m,{label:"\u8D77\u6B62\u65F6\u95F4"},{default:t(()=>[l(N,{effect:"light",content:"\u5F00\u59CB\u65F6\u95F4\u6233",placement:"top",enterable:!1},{default:t(()=>[l(T,{modelValue:b.value,"onUpdate:modelValue":e[2]||(e[2]=a=>b.value=a),min:0},null,8,["modelValue"])]),_:1}),l(N,{effect:"light",content:"\u7ED3\u675F\u65F6\u95F4\u6233",placement:"top",enterable:!1},{default:t(()=>[l(T,{modelValue:y.value,"onUpdate:modelValue":e[3]||(e[3]=a=>y.value=a),min:0},null,8,["modelValue"])]),_:1})]),_:1}),l(m,{label:"\u65E5\u5FD7\u7EA7\u522B"},{default:t(()=>[l(Q,{class:"auto-complete-input",modelValue:o.value.severityText,"onUpdate:modelValue":e[4]||(e[4]=a=>o.value.severityText=a),"fetch-suggestions":P,clearable:"",placeholder:"\u8BF7\u8F93\u5165\u65E5\u5FD7\u7EA7\u522B"},null,8,["modelValue"])]),_:1}),l(m,{label:"\u5185\u5BB9\u5173\u952E\u8BCD"},{default:t(()=>[l(p,{modelValue:o.value.keyword,"onUpdate:modelValue":e[5]||(e[5]=a=>o.value.keyword=a),placeholder:"\u8BF7\u8F93\u5165\u4E00\u4E2A\u5185\u5BB9\u5173\u952E\u8BCD",clearable:""},null,8,["modelValue"])]),_:1}),l(m,{label:"\u5185\u5BB9\u4E0D\u5305\u542B\u7684\u5173\u952E\u8BCD"},{default:t(()=>[l(p,{modelValue:o.value.keywordNotIncluded,"onUpdate:modelValue":e[6]||(e[6]=a=>o.value.keywordNotIncluded=a),placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9\u4E0D\u5305\u542B\u7684\u5173\u952E\u8BCD",clearable:""},null,8,["modelValue"])]),_:1}),l(m,null,{default:t(()=>[l(U,{type:"primary",onClick:h},{default:t(()=>e[20]||(e[20]=[V("\u641C\u7D22")])),_:1})]),_:1})]),_:1},8,["model"])]),l(R),(k(!0),E(J,null,de(S.value,a=>(k(),me(s,{gutter:5,key:a,style:{"word-break":"break-all"}},{default:t(()=>[l(f,{span:4},{default:t(()=>[V(w(a.serviceName),1)]),_:2},1024),l(f,{span:3},{default:t(()=>[V(w(ie(O)(a.timestamp)),1)]),_:2},1024),l(f,{span:2},{default:t(()=>[V(w(a.severityText),1)]),_:2},1024),l(f,{span:12},{default:t(()=>[V(w(a.content),1)]),_:2},1024),l(f,{span:1},{default:t(()=>[l(N,{effect:"light",content:"\u67E5\u770B\u65E5\u5FD7\u5BF9\u5E94\u94FE\u8DEF\u4FE1\u606F",placement:"top",enterable:!1},{default:t(()=>[l(U,{type:"primary",circle:"",size:"small",onClick:K=>q(a)},{default:t(()=>[l(C,null,{default:t(()=>[l(X)]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024),l(f,{span:1},{default:t(()=>[l(N,{effect:"light",content:"\u67E5\u770B\u65E5\u5FD7\u5177\u4F53\u4FE1\u606F",placement:"top",enterable:!1},{default:t(()=>[l(U,{type:"primary",circle:"",size:"small",onClick:K=>j(a)},{default:t(()=>[l(C,null,{default:t(()=>[l(Y)]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)),g("div",ce,[l(B,{"current-page":o.value.pageNum,"onUpdate:currentPage":e[7]||(e[7]=a=>o.value.pageNum=a),"page-size":o.value.pageSize,"onUpdate:pageSize":e[8]||(e[8]=a=>o.value.pageSize=a),"page-sizes":[2,5,10,20],layout:"total, prev, pager, next, sizes",total:z.value,onSizeChange:$,onCurrentChange:M},null,8,["current-page","page-size","total"])])]),_:1})]),l(G,{modelValue:I.value,"onUpdate:modelValue":e[17]||(e[17]=a=>I.value=a),title:"Log",width:"60%"},{default:t(()=>[l(x,{"label-position":"left","label-width":"auto",model:r.value,disabled:""},{default:t(()=>[l(m,{label:"\u65E5\u5FD7\u65F6\u95F4"},{default:t(()=>[l(p,{modelValue:r.value.timestamp,"onUpdate:modelValue":e[9]||(e[9]=a=>r.value.timestamp=a)},null,8,["modelValue"])]),_:1}),l(m,{label:"\u65E5\u5FD7\u7EA7\u522B"},{default:t(()=>[l(p,{modelValue:r.value.severityText,"onUpdate:modelValue":e[10]||(e[10]=a=>r.value.severityText=a)},null,8,["modelValue"])]),_:1}),l(m,{label:"\u65E5\u5FD7\u5185\u5BB9"},{default:t(()=>[l(p,{type:"textarea",modelValue:r.value.content,"onUpdate:modelValue":e[11]||(e[11]=a=>r.value.content=a)},null,8,["modelValue"])]),_:1}),l(m,{label:"\u670D\u52A1\u540D\u79F0"},{default:t(()=>[l(p,{modelValue:r.value.serviceName,"onUpdate:modelValue":e[12]||(e[12]=a=>r.value.serviceName=a)},null,8,["modelValue"])]),_:1}),l(m,{label:"\u8FFD\u8E2AId"},{default:t(()=>[l(p,{modelValue:r.value.traceId,"onUpdate:modelValue":e[13]||(e[13]=a=>r.value.traceId=a)},null,8,["modelValue"])]),_:1}),l(m,{label:"SpanId"},{default:t(()=>[l(p,{modelValue:r.value.spanId,"onUpdate:modelValue":e[14]||(e[14]=a=>r.value.spanId=a)},null,8,["modelValue"])]),_:1}),l(m,{label:"\u72B6\u6001"},{default:t(()=>[l(p,{modelValue:r.value.error,"onUpdate:modelValue":e[15]||(e[15]=a=>r.value.error=a)},null,8,["modelValue"])]),_:1}),l(m,{label:"Tags"},{default:t(()=>[l(p,{type:"textarea",rows:3,modelValue:r.value.tags,"onUpdate:modelValue":e[16]||(e[16]=a=>r.value.tags=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}},fe=ue(ve,[["__scopeId","data-v-302e39b6"]]);export{fe as default};
