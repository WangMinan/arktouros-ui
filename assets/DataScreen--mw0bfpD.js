import{u as R,a as A}from"./@vueuse-BK87aVxb.js";import{u as L}from"./vue-router-Bu4PTcIf.js";import{u as Q}from"./index-B4tlj57P.js";import{d as B,s as P}from"./pinia-C1gkOLtH.js";import{r as d,ag as i,o as S,c as H,a as v,O as k,u as g,Q as e,I as a,X as $,b as V,P as X,a4 as Z,H as q,M as I}from"./@vue-DJGElsCt.js";import{_ as E}from"./index-BtbS6tqV.js";import{S as F}from"./ServiceTopologyDiagram-Clz3BAqR.js";import{g as K}from"./index-DZQGnnvc.js";import{t as O}from"./dateUtil-NlCD2qvi.js";import{T as W,g as Y}from"./TraceTopologyDiagram-B_fY5f90.js";import{M as j}from"./MetricDiagram-Chu_Hwlw.js";import{g as G}from"./index-BPV85VCF.js";import"./@element-plus-dQIYR_U6.js";import"./element-plus-CB4diBvn.js";import"./lodash-es-BKnOc8U_.js";import"./@popperjs-Bm-vPkQ2.js";import"./@ctrl-CBTFr1m8.js";import"./dayjs-DUzyJfMy.js";import"./async-validator-DBBz-maN.js";import"./memoize-one-DxrTgWdQ.js";import"./normalize-wheel-es-Cg1Do7zv.js";import"./@floating-ui-BPK96wVr.js";import"./pinia-plugin-persistedstate-BlIkimV0.js";import"./destr-Cx7WjB9q.js";import"./deep-pick-omit-B1UrSIxj.js";import"./echarts-BIEvihnk.js";import"./tslib-BDyQ-Jie.js";import"./zrender-CdholsD1.js";import"./axios-upsvKRUO.js";import"./nprogress-vyVW41Zc.js";import"./arktourosUiConfigUtil-DM9bp1OR.js";const C=B("header",()=>{const h=d({service:""});return{currentHeader:h,resetActive:()=>{h.value.service=""}}},{persist:{storage:sessionStorage,paths:["currentHeader"],key:"currentHeader"}}),J={class:"header",id:"header"},U={class:"l-content"},ee={class:"r-content"},ae={__name:"DataScreenHeader",setup(h){const s=L(),M=C(),{currentHeader:y}=P(M),n=R({storageKey:"theme-appearance",valueDark:"dark",valueLight:"light"}),_=Q(),T=A(n),w=u=>{let t=u.clientX,c=u.clientY,f=Math.hypot(Math.max(t,innerWidth-t),Math.max(c,innerHeight-c));if(!document.startViewTransition){T();return}document.startViewTransition(async()=>{T()}).ready.then(()=>{let p=[`circle(0px at ${t}px ${c}px)`,`circle(${f}px at ${t}px ${c}px)`];document.documentElement.animate({clipPath:n.value?[...p].reverse():p},{duration:200,easing:"ease-in",pseudoElement:n.value?"::view-transition-old(root)":"::view-transition-new(root)"})})};return(u,t)=>{const c=i("el-switch"),f=i("el-button"),p=i("el-tooltip"),N=i("el-space");return S(),H("div",J,[v("div",U,[v("h1",null,"\u670D\u52A1\u6CBB\u7406\u589E\u5F3A\u8F6F\u4EF6\u53EF\u89C6\u5316\u5927\u5C4F -- \u5F53\u524D\u670D\u52A1: "+k(g(y).service),1)]),t[2]||(t[2]=v("div",{class:"flex-grow"},null,-1)),v("div",ee,[e(N,{wrap:""},{default:a(()=>[v("div",null,[e(c,{"model-value":g(n),onClick:w,"active-icon":"Sunny","inactive-icon":"Moon",size:"large","inline-prompt":"",style:{"--el-switch-on-color":"#64676a"}},null,8,["model-value"])]),v("div",null,[e(p,{content:"\u8FD4\u56DE\u9996\u9875",placement:"bottom"},{default:a(()=>[e(f,{icon:"HomeFilled",circle:"",onClick:t[0]||(t[0]=b=>{g(s).push("/main"),g(_).resetActive()})})]),_:1})]),v("div",null,[e(p,{content:"\u5237\u65B0",placement:"bottom"},{default:a(()=>[e(f,{icon:"Refresh",circle:"",onClick:t[1]||(t[1]=b=>g(s).go(0))})]),_:1})])]),_:1})])])}}},te=E(ae,[["__scopeId","data-v-7c9e3d00"]]),re={class:"data-card-container"},le={__name:"DataScreenMain",setup(h){const s=d(""),M=$({query:"",namespace:"default",pageNum:1,pageSize:100}),y=C(),n=d({pageNum:1,pageSize:3,serviceName:"",traceId:"",keyword:"",keywordNotIncluded:"",severityText:"",startTimestamp:0,endTimestamp:Date.now()}),_=$({serviceName:"",pageNum:1,pageSize:10}),T=async()=>{const r=await G(M);r===null&&(s.value="");const o=[];r.result.data.map(l=>{o.push(l.name)}),s.value=o[Math.floor(Math.random()*o.length)],y.$patch(l=>{l.currentHeader.service=s.value})},w=d([]),u=d([]),t=async()=>{const r=await K(n.value);w.value=r.result.data},c=async()=>{const r=await Y(_);r===null||r.result.length===0||(r.result.forEach(o=>{o.traceIds.forEach(l=>{u.value.push(l)})}),N.value.getTopology(u.value[Math.floor(Math.random()*u.value.length)]))},f=async()=>{await b.value.toggleMetrics()},p=async()=>{await T(),await t(),await c(),await f()},N=d(),b=d(),D=d({serviceName:"",metricNameLimit:2,startTimeStamp:0,endTimeStamp:0});return V(()=>{p();const r=document.getElementById("service-topology-dom");r.style.width="400px",r.style.height="250px";const o=document.getElementById("trace-topology-div");o.style.width="300px",o.style.height="180px"}),(r,o)=>{const l=i("el-card"),m=i("el-col"),z=i("el-row");return S(),H("div",re,[e(z,{gutter:15,class:"diagram-row-1"},{default:a(()=>[e(m,{span:14},{default:a(()=>[e(l,{class:"diagram-el-card"},{default:a(()=>[e(F,{class:"service-topology-diagram",namespace:"default",symbolSize:25,repulsion:50,edgeLength:50})]),_:1})]),_:1}),e(m,{span:10},{default:a(()=>[e(l,{class:"diagram-el-card"},{default:a(()=>[(S(!0),H(X,null,Z(w.value,x=>(S(),q(z,{"v-if":w.value.length>0,key:x,style:{"word-break":"break-all"}},{default:a(()=>[e(m,{span:4},{default:a(()=>[I(k(x.serviceName),1)]),_:2},1024),e(m,{span:4},{default:a(()=>[I(k(g(O)(x.timestamp)),1)]),_:2},1024),e(m,{span:3},{default:a(()=>[I(k(x.severityText),1)]),_:2},1024),e(m,{span:8},{default:a(()=>[I(k(x.content),1)]),_:2},1024)]),_:2},1032,["v-if"]))),128))]),_:1})]),_:1})]),_:1}),e(z,{gutter:15,class:"diagram-row-2"},{default:a(()=>[e(m,{span:8},{default:a(()=>[e(l,{class:"diagram-el-card"},{default:a(()=>[e(W,{ref_key:"traceTopologyDiagramRef",ref:N,serviceName:["default",s.value],innerService:!1},null,8,["serviceName"])]),_:1})]),_:1}),e(m,{span:16},{default:a(()=>[e(l,{class:"diagram-el-card",id:"metricCardRef"},{default:a(()=>[e(j,{ref_key:"metricDiagramRef",ref:b,metricQueryDto:D.value,startAndStopTime:["1990-09-25T00:00:00Z","2024-09-25T00:00:00Z"]},null,8,["metricQueryDto"])]),_:1})]),_:1})]),_:1})])}}},ie=E(le,[["__scopeId","data-v-7deb1bd1"]]),oe={class:"dataScreenContainer"},se={__name:"DataScreen",setup(h){return(s,M)=>{const y=i("el-header"),n=i("el-main"),_=i("el-container");return S(),H("div",oe,[e(_,null,{default:a(()=>[e(y,null,{default:a(()=>[e(te)]),_:1}),e(n,null,{default:a(()=>[e(ie)]),_:1})]),_:1})])}}},ne=E(se,[["__scopeId","data-v-46aa57ad"]]);export{ne as default};
