import{u as Q,a as R}from"./@vueuse-BVHWMYgJ.js";import{u as A}from"./vue-router-D3urSGSZ.js";import{u as L}from"./index-DJoK9fKz.js";import{d as B,s as $}from"./pinia-Cwyq1Zey.js";import{r as m,ag as l,o as k,c as H,a as u,O as M,u as g,Q as e,I as a,X as z,b as V,P as X,a4 as Z,H as q,M as I}from"./@vue-Bab_5bp4.js";import{_ as E}from"./index-CuPN7TGw.js";import{S as F}from"./ServiceTopologyDiagram-C_gkdtah.js";import{g as K}from"./index-B4aBeUs8.js";import{t as O}from"./dateUtil-NlCD2qvi.js";import{T as P,g as W}from"./TraceTopologyDiagram-D20XPUpw.js";import{M as Y}from"./MetricDiagram-M-cnDCbJ.js";import"./vue-demi-Dq6ymT-8.js";import"./@element-plus-CJub2bFt.js";import"./element-plus-CZoMHS9N.js";import"./lodash-es-CBP5Y4wy.js";import"./@popperjs-CsO2-mKt.js";import"./@ctrl-r5W6hzzQ.js";import"./dayjs-B_aAqRSu.js";import"./async-validator-CRx4dHSJ.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./@floating-ui-D06mcbP9.js";import"./pinia-plugin-persistedstate-8SpmOswp.js";import"./destr-CVtkxrq9.js";import"./deep-pick-omit-CegYQlcN.js";import"./index-BQ96J7xc.js";import"./axios-upsvKRUO.js";import"./nprogress-Dx41icWA.js";import"./arktourosUiConfigUtil-DM9bp1OR.js";import"./echarts-CqqBsREq.js";import"./tslib-BDyQ-Jie.js";import"./zrender-C06augsh.js";const C=B("header",()=>{const h=m({service:""});return{currentHeader:h,resetActive:()=>{h.value.service=""}}},{persist:{storage:sessionStorage,paths:["currentHeader"],key:"currentHeader"}}),j={class:"header",id:"header"},G={class:"l-content"},J={class:"r-content"},U={__name:"DataScreenHeader",setup(h){const i=A(),_=C(),{currentHeader:d}=$(_),o=Q({storageKey:"theme-appearance",valueDark:"dark",valueLight:"light"}),y=L(),p=R(o),w=S=>{let t=S.clientX,s=S.clientY,v=Math.hypot(Math.max(t,innerWidth-t),Math.max(s,innerHeight-s));if(!document.startViewTransition){p();return}document.startViewTransition(async()=>{p()}).ready.then(()=>{let n=[`circle(0px at ${t}px ${s}px)`,`circle(${v}px at ${t}px ${s}px)`];document.documentElement.animate({clipPath:o.value?[...n].reverse():n},{duration:200,easing:"ease-in",pseudoElement:o.value?"::view-transition-old(root)":"::view-transition-new(root)"})})};return(S,t)=>{const s=l("el-switch"),v=l("el-button"),n=l("el-tooltip"),x=l("el-space");return k(),H("div",j,[u("div",G,[u("h1",null,"\u670D\u52A1\u6CBB\u7406\u589E\u5F3A\u8F6F\u4EF6\u53EF\u89C6\u5316\u5927\u5C4F -- \u5F53\u524D\u670D\u52A1: "+M(g(d).service),1)]),t[2]||(t[2]=u("div",{class:"flex-grow"},null,-1)),u("div",J,[e(x,{wrap:""},{default:a(()=>[u("div",null,[e(s,{"model-value":g(o),onClick:w,"active-icon":"Sunny","inactive-icon":"Moon",size:"large","inline-prompt":"",style:{"--el-switch-on-color":"#64676a"}},null,8,["model-value"])]),u("div",null,[e(n,{content:"\u8FD4\u56DE\u9996\u9875",placement:"bottom"},{default:a(()=>[e(v,{icon:"HomeFilled",circle:"",onClick:t[0]||(t[0]=D=>{g(i).push("/main"),g(y).resetActive()})})]),_:1})]),u("div",null,[e(n,{content:"\u5237\u65B0",placement:"bottom"},{default:a(()=>[e(v,{icon:"Refresh",circle:"",onClick:t[1]||(t[1]=D=>g(i).go(0))})]),_:1})])]),_:1})])])}}},ee=E(U,[["__scopeId","data-v-7c9e3d00"]]),ae={class:"data-card-container"},te={__name:"DataScreenMain",setup(h){const i=m("");z({query:"",namespace:"default",pageNum:1,pageSize:100});const _=C();$(_);const d=m({pageNum:1,pageSize:3,serviceName:"",traceId:"",keyword:"",keywordNotIncluded:"",severityText:"",startTimestamp:0,endTimestamp:Date.now()}),o=z({serviceName:"",pageNum:1,pageSize:10}),y=async()=>{i.value="service_f",d.value.serviceName=i.value,o.serviceName=i.value,D.value.serviceName=i.value,_.$patch(r=>{r.currentHeader.service=i.value})},p=m([]),w=m([]),S=async()=>{const r=await K(d.value);p.value=r.result.data},t=async()=>{const r=await W(o);r===null||r.result.length===0||(r.result.forEach(N=>{N.traceIds.forEach(f=>{w.value.push(f)})}),n.value.getTopology(w.value[Math.floor(Math.random()*w.value.length)]))},s=async()=>{await x.value.toggleMetrics()},v=async()=>{await y(),await S(),await t(),await s()},n=m(),x=m(),D=m({serviceName:"",metricNameLimit:2,startTimeStamp:0,endTimeStamp:0});return V(()=>{v();const r=document.getElementById("service-topology-dom");r.style.width="400px",r.style.height="250px";const N=document.getElementById("trace-topology-div");N.style.width="300px",N.style.height="180px"}),(r,N)=>{const f=l("el-card"),c=l("el-col"),b=l("el-row");return k(),H("div",ae,[e(b,{gutter:15,class:"diagram-row-1"},{default:a(()=>[e(c,{span:14},{default:a(()=>[e(f,{class:"diagram-el-card"},{default:a(()=>[e(F,{class:"service-topology-diagram",namespace:"default",symbolSize:25,repulsion:50,edgeLength:50})]),_:1})]),_:1}),e(c,{span:10},{default:a(()=>[e(f,{class:"diagram-el-card"},{default:a(()=>[(k(!0),H(X,null,Z(p.value,T=>(k(),q(b,{"v-if":p.value.length>0,key:T,style:{"word-break":"break-all"}},{default:a(()=>[e(c,{span:4},{default:a(()=>[I(M(T.serviceName),1)]),_:2},1024),e(c,{span:4},{default:a(()=>[I(M(g(O)(T.timestamp)),1)]),_:2},1024),e(c,{span:3},{default:a(()=>[I(M(T.severityText),1)]),_:2},1024),e(c,{span:8},{default:a(()=>[I(M(T.content),1)]),_:2},1024)]),_:2},1032,["v-if"]))),128))]),_:1})]),_:1})]),_:1}),e(b,{gutter:15,class:"diagram-row-2"},{default:a(()=>[e(c,{span:8},{default:a(()=>[e(f,{class:"diagram-el-card"},{default:a(()=>[e(P,{ref_key:"traceTopologyDiagramRef",ref:n,serviceName:["default",i.value],innerService:!1},null,8,["serviceName"])]),_:1})]),_:1}),e(c,{span:16},{default:a(()=>[e(f,{class:"diagram-el-card",id:"metricCardRef"},{default:a(()=>[e(Y,{ref_key:"metricDiagramRef",ref:x,metricQueryDto:D.value,startAndStopTime:["1990-09-25T00:00:00Z","2024-09-25T00:00:00Z"]},null,8,["metricQueryDto"])]),_:1})]),_:1})]),_:1})])}}},re=E(te,[["__scopeId","data-v-50c1f2ea"]]),ie={class:"dataScreenContainer"},le={__name:"DataScreen",setup(h){return(i,_)=>{const d=l("el-header"),o=l("el-main"),y=l("el-container");return k(),H("div",ie,[e(y,null,{default:a(()=>[e(d,null,{default:a(()=>[e(ee)]),_:1}),e(o,null,{default:a(()=>[e(re)]),_:1})]),_:1})])}}},oe=E(le,[["__scopeId","data-v-46aa57ad"]]);export{oe as default};
