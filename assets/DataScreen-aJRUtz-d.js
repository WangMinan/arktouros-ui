import{u as A,a as R}from"./@vueuse-CVe10TcS.js";import{u as L}from"./vue-router-DZCgBLc_.js";import{u as V}from"./index-TrrzJY0k.js";import{d as Z,s as $}from"./pinia-Ba7ZwxHl.js";import{r as m,ai as l,o as k,c as H,a as u,U as x,u as g,V as e,P as a,Z as z,b as B,F,a8 as P,O as Q,T as I}from"./@vue-DPv8mhWq.js";import{_ as E}from"./index-Cyv_V8Nx.js";import{S as q}from"./ServiceTopologyDiagram-D1TKrtqc.js";import{g as K}from"./index-nWCjhBJH.js";import{t as O}from"./dateUtil-NlCD2qvi.js";import{T as U,g as W}from"./TraceTopologyDiagram-aXXTNjXA.js";import{M as X}from"./MetricDiagram-DAZcVzif.js";import"./@element-plus-CAhoeMEH.js";import"./element-plus-BUy4L-fR.js";import"./lodash-es-D0J8aJCM.js";import"./@popperjs-CsO2-mKt.js";import"./@ctrl-r5W6hzzQ.js";import"./dayjs-DuEr9S7h.js";import"./async-validator-BTg-XjMW.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./@floating-ui-D06mcbP9.js";import"./pinia-plugin-persistedstate-8SpmOswp.js";import"./destr-CVtkxrq9.js";import"./deep-pick-omit-CegYQlcN.js";import"./index-XpeRMsl_.js";import"./axios-CCb-kr4I.js";import"./nprogress-Du6PRFDQ.js";import"./arktourosUiConfigUtil-DM9bp1OR.js";import"./echarts-BRPGUpj0.js";import"./tslib-BDyQ-Jie.js";import"./zrender-UROijHWN.js";const C=Z("header",()=>{const h=m({service:""});return{currentHeader:h,resetActive:()=>{h.value.service=""}}},{persist:{storage:sessionStorage,paths:["currentHeader"],key:"currentHeader"}}),Y={class:"header",id:"header"},j={class:"l-content"},G={class:"r-content"},J={__name:"DataScreenHeader",setup(h){const i=L(),_=C(),{currentHeader:d}=$(_),s=A({storageKey:"theme-appearance",valueDark:"dark",valueLight:"light"}),y=V(),p=R(s),w=S=>{let t=S.clientX,o=S.clientY,v=Math.hypot(Math.max(t,innerWidth-t),Math.max(o,innerHeight-o));if(!document.startViewTransition){p();return}document.startViewTransition(async()=>{p()}).ready.then(()=>{let n=[`circle(0px at ${t}px ${o}px)`,`circle(${v}px at ${t}px ${o}px)`];document.documentElement.animate({clipPath:s.value?[...n].reverse():n},{duration:200,easing:"ease-in",pseudoElement:s.value?"::view-transition-old(root)":"::view-transition-new(root)"})})};return(S,t)=>{const o=l("el-switch"),v=l("el-button"),n=l("el-tooltip"),M=l("el-space");return k(),H("div",Y,[u("div",j,[u("h1",null,"\u670D\u52A1\u6CBB\u7406\u589E\u5F3A\u8F6F\u4EF6\u53EF\u89C6\u5316\u5927\u5C4F -- \u5F53\u524D\u670D\u52A1: "+x(g(d).service),1)]),t[2]||(t[2]=u("div",{class:"flex-grow"},null,-1)),u("div",G,[e(M,{wrap:""},{default:a(()=>[u("div",null,[e(o,{"model-value":g(s),onClick:w,"active-icon":"Sunny","inactive-icon":"Moon",size:"large","inline-prompt":"",style:{"--el-switch-on-color":"#64676a"}},null,8,["model-value"])]),u("div",null,[e(n,{content:"\u8FD4\u56DE\u9996\u9875",placement:"bottom"},{default:a(()=>[e(v,{icon:"HomeFilled",circle:"",onClick:t[0]||(t[0]=D=>{g(i).push("/main"),g(y).resetActive()})})]),_:1})]),u("div",null,[e(n,{content:"\u5237\u65B0",placement:"bottom"},{default:a(()=>[e(v,{icon:"Refresh",circle:"",onClick:t[1]||(t[1]=D=>g(i).go(0))})]),_:1})])]),_:1})])])}}},ee=E(J,[["__scopeId","data-v-7c9e3d00"]]),ae={class:"data-card-container"},te={__name:"DataScreenMain",setup(h){const i=m("");z({query:"",namespace:"default",pageNum:1,pageSize:100});const _=C();$(_);const d=m({pageNum:1,pageSize:3,serviceName:"",traceId:"",keyword:"",keywordNotIncluded:"",severityText:"",startTimestamp:0,endTimestamp:Date.now()}),s=z({serviceName:"",pageNum:1,pageSize:10}),y=async()=>{i.value="service_f",d.value.serviceName=i.value,s.serviceName=i.value,D.value.serviceName=i.value,_.$patch(r=>{r.currentHeader.service=i.value})},p=m([]),w=m([]),S=async()=>{const r=await K(d.value);p.value=r.result.data},t=async()=>{const r=await W(s);r===null||r.result.length===0||(r.result.forEach(T=>{T.traceIds.forEach(f=>{w.value.push(f)})}),n.value.getTopology(w.value[Math.floor(Math.random()*w.value.length)]))},o=async()=>{await M.value.toggleMetrics()},v=async()=>{await y(),await S(),await t(),await o()},n=m(),M=m(),D=m({serviceName:"",metricNameLimit:2,startTimeStamp:0,endTimeStamp:0});return B(()=>{v();const r=document.getElementById("service-topology-dom");r.style.width="400px",r.style.height="250px";const T=document.getElementById("trace-topology-div");T.style.width="300px",T.style.height="180px"}),(r,T)=>{const f=l("el-card"),c=l("el-col"),b=l("el-row");return k(),H("div",ae,[e(b,{gutter:15,class:"diagram-row-1"},{default:a(()=>[e(c,{span:14},{default:a(()=>[e(f,{class:"diagram-el-card"},{default:a(()=>[e(q,{class:"service-topology-diagram",namespace:"default",symbolSize:25,repulsion:50,edgeLength:50})]),_:1})]),_:1}),e(c,{span:10},{default:a(()=>[e(f,{class:"diagram-el-card"},{default:a(()=>[(k(!0),H(F,null,P(p.value,N=>(k(),Q(b,{"v-if":p.value.length>0,key:N,style:{"word-break":"break-all"}},{default:a(()=>[e(c,{span:4},{default:a(()=>[I(x(N.serviceName),1)]),_:2},1024),e(c,{span:4},{default:a(()=>[I(x(g(O)(N.timestamp)),1)]),_:2},1024),e(c,{span:3},{default:a(()=>[I(x(N.severityText),1)]),_:2},1024),e(c,{span:8},{default:a(()=>[I(x(N.content),1)]),_:2},1024)]),_:2},1032,["v-if"]))),128))]),_:1})]),_:1})]),_:1}),e(b,{gutter:15,class:"diagram-row-2"},{default:a(()=>[e(c,{span:8},{default:a(()=>[e(f,{class:"diagram-el-card"},{default:a(()=>[e(U,{ref_key:"traceTopologyDiagramRef",ref:n,serviceName:["default",i.value],innerService:!1},null,8,["serviceName"])]),_:1})]),_:1}),e(c,{span:16},{default:a(()=>[e(f,{class:"diagram-el-card",id:"metricCardRef"},{default:a(()=>[e(X,{ref_key:"metricDiagramRef",ref:M,metricQueryDto:D.value,startAndStopTime:["1990-09-25T00:00:00Z","2024-09-25T00:00:00Z"]},null,8,["metricQueryDto"])]),_:1})]),_:1})]),_:1})])}}},re=E(te,[["__scopeId","data-v-50c1f2ea"]]),ie={class:"dataScreenContainer"},le={__name:"DataScreen",setup(h){return(i,_)=>{const d=l("el-header"),s=l("el-main"),y=l("el-container");return k(),H("div",ie,[e(y,null,{default:a(()=>[e(d,null,{default:a(()=>[e(ee)]),_:1}),e(s,null,{default:a(()=>[e(re)]),_:1})]),_:1})])}}},se=E(le,[["__scopeId","data-v-46aa57ad"]]);export{se as default};
