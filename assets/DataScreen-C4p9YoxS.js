import{u as R,a as A}from"./@vueuse-BrKJyrsM.js";import{u as L}from"./vue-router-DZ3MrWk1.js";import{u as Q}from"./index-DQDgIJ2e.js";import{d as V,s as B}from"./pinia-B3EJDjGG.js";import{r as d,ag as l,c as H,o as S,a as v,O as k,u as g,Q as e,I as a,X as z,b as P,P as X,a6 as Z,H as q,M as I}from"./@vue-CnBZ4jx_.js";import{_ as $}from"./index-Dp-vnoFp.js";import{S as F}from"./ServiceTopologyDiagram-DF76PIz4.js";import{g as K}from"./index-DYhqAdoa.js";import{t as O}from"./dateUtil-NlCD2qvi.js";import{T as W}from"./TraceTopologyDiagram-7DbnLQIy.js";import{g as Y}from"./index-smoZw7E1.js";import{M as j}from"./MetricDiagram-XpNqQHzp.js";import{g as G}from"./index-BgX6ccBS.js";import"./@element-plus-Rv25Faa4.js";import"./element-plus-0z3gLYqD.js";import"./lodash-es-C-xrcuFl.js";import"./@popperjs-DB1lLFnh.js";import"./@ctrl-r5W6hzzQ.js";import"./dayjs-B_aAqRSu.js";import"./async-validator-CRx4dHSJ.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-BQoi3Ox2.js";import"./@floating-ui-BCLhozDd.js";import"./pinia-plugin-persistedstate-8SpmOswp.js";import"./destr-CVtkxrq9.js";import"./deep-pick-omit-CegYQlcN.js";import"./echarts-DuzIGl-8.js";import"./tslib-BDyQ-Jie.js";import"./zrender-Cg4aFrUj.js";import"./axios-DW_MHI2K.js";import"./nprogress-Dx41icWA.js";import"./arktourosUiConfigUtil-DM9bp1OR.js";const C=V("header",()=>{const h=d({service:""});return{currentHeader:h,resetActive:()=>{h.value.service=""}}},{persist:{storage:sessionStorage,paths:["currentHeader"],key:"currentHeader"}}),J={class:"header",id:"header"},U={class:"l-content"},ee={class:"r-content"},ae={__name:"DataScreenHeader",setup(h){const s=L(),M=C(),{currentHeader:y}=B(M),n=R({storageKey:"theme-appearance",valueDark:"dark",valueLight:"light"}),_=Q(),T=A(n),w=u=>{let t=u.clientX,c=u.clientY,f=Math.hypot(Math.max(t,innerWidth-t),Math.max(c,innerHeight-c));if(!document.startViewTransition){T();return}document.startViewTransition(async()=>{T()}).ready.then(()=>{let p=[`circle(0px at ${t}px ${c}px)`,`circle(${f}px at ${t}px ${c}px)`];document.documentElement.animate({clipPath:n.value?[...p].reverse():p},{duration:200,easing:"ease-in",pseudoElement:n.value?"::view-transition-old(root)":"::view-transition-new(root)"})})};return(u,t)=>{const c=l("el-switch"),f=l("el-button"),p=l("el-tooltip"),N=l("el-space");return S(),H("div",J,[v("div",U,[v("h1",null,"\u670D\u52A1\u6CBB\u7406\u589E\u5F3A\u8F6F\u4EF6\u53EF\u89C6\u5316\u5927\u5C4F -- \u5F53\u524D\u670D\u52A1: "+k(g(y).service),1)]),t[2]||(t[2]=v("div",{class:"flex-grow"},null,-1)),v("div",ee,[e(N,{wrap:""},{default:a(()=>[v("div",null,[e(c,{"model-value":g(n),onClick:w,"active-icon":"Sunny","inactive-icon":"Moon",size:"large","inline-prompt":"",style:{"--el-switch-on-color":"#64676a"}},null,8,["model-value"])]),v("div",null,[e(p,{content:"\u8FD4\u56DE\u9996\u9875",placement:"bottom"},{default:a(()=>[e(f,{icon:"HomeFilled",circle:"",onClick:t[0]||(t[0]=b=>{g(s).push("/main"),g(_).resetActive()})})]),_:1})]),v("div",null,[e(p,{content:"\u5237\u65B0",placement:"bottom"},{default:a(()=>[e(f,{icon:"Refresh",circle:"",onClick:t[1]||(t[1]=b=>g(s).go(0))})]),_:1})])]),_:1})])])}}},te=$(ae,[["__scopeId","data-v-7c9e3d00"]]),re={class:"data-card-container"},ie={__name:"DataScreenMain",setup(h){const s=d(""),M=z({query:"",namespace:"default",pageNum:1,pageSize:100}),y=C(),n=d({pageNum:1,pageSize:3,serviceName:"",traceId:"",keyword:"",keywordNotIncluded:"",severityText:"",startTimestamp:0,endTimestamp:Date.now()}),_=z({serviceName:"",pageNum:1,pageSize:10}),T=async()=>{const r=await G(M);r===null&&(s.value="");const o=[];r.result.data.map(i=>{o.push(i.name)}),s.value=o[Math.floor(Math.random()*o.length)],y.$patch(i=>{i.currentHeader.service=s.value})},w=d([]),u=d([]),t=async()=>{const r=await K(n.value);w.value=r.result.data},c=async()=>{const r=await Y(_);r===null||r.result.length===0||(r.result.forEach(o=>{o.traceIds.forEach(i=>{u.value.push(i)})}),N.value.getTopology(u.value[Math.floor(Math.random()*u.value.length)]))},f=async()=>{await b.value.toggleMetrics()},p=async()=>{await T(),await t(),await c(),await f()},N=d(),b=d(),D=d({serviceName:"",metricNameLimit:2,startTimeStamp:0,endTimeStamp:0});return P(()=>{p();const r=document.getElementById("service-topology-dom");r.style.width="400px",r.style.height="250px";const o=document.getElementById("trace-topology-div");o.style.width="300px",o.style.height="180px"}),(r,o)=>{const i=l("el-card"),m=l("el-col"),E=l("el-row");return S(),H("div",re,[e(E,{gutter:15,class:"diagram-row-1"},{default:a(()=>[e(m,{span:14},{default:a(()=>[e(i,{class:"diagram-el-card"},{default:a(()=>[e(F,{class:"service-topology-diagram",namespace:"default",symbolSize:25,repulsion:50,edgeLength:50})]),_:1})]),_:1}),e(m,{span:10},{default:a(()=>[e(i,{class:"diagram-el-card"},{default:a(()=>[(S(!0),H(X,null,Z(w.value,x=>(S(),q(E,{"v-if":w.value.length>0,key:x,style:{"word-break":"break-all"}},{default:a(()=>[e(m,{span:4},{default:a(()=>[I(k(x.serviceName),1)]),_:2},1024),e(m,{span:4},{default:a(()=>[I(k(g(O)(x.timestamp)),1)]),_:2},1024),e(m,{span:3},{default:a(()=>[I(k(x.severityText),1)]),_:2},1024),e(m,{span:8},{default:a(()=>[I(k(x.content),1)]),_:2},1024)]),_:2},1032,["v-if"]))),128))]),_:1})]),_:1})]),_:1}),e(E,{gutter:15,class:"diagram-row-2"},{default:a(()=>[e(m,{span:8},{default:a(()=>[e(i,{class:"diagram-el-card"},{default:a(()=>[e(W,{ref_key:"traceTopologyDiagramRef",ref:N,serviceName:["default",s.value],innerService:!1},null,8,["serviceName"])]),_:1})]),_:1}),e(m,{span:16},{default:a(()=>[e(i,{class:"diagram-el-card",id:"metricCardRef"},{default:a(()=>[e(j,{ref_key:"metricDiagramRef",ref:b,metricQueryDto:D.value,startAndStopTime:["1990-09-25T00:00:00Z","2024-09-25T00:00:00Z"]},null,8,["metricQueryDto"])]),_:1})]),_:1})]),_:1})])}}},le=$(ie,[["__scopeId","data-v-7deb1bd1"]]),oe={class:"dataScreenContainer"},se={__name:"DataScreen",setup(h){return(s,M)=>{const y=l("el-header"),n=l("el-main"),_=l("el-container");return S(),H("div",oe,[e(_,null,{default:a(()=>[e(y,null,{default:a(()=>[e(te)]),_:1}),e(n,null,{default:a(()=>[e(le)]),_:1})]),_:1})])}}},ne=$(se,[["__scopeId","data-v-46aa57ad"]]);export{ne as default};
