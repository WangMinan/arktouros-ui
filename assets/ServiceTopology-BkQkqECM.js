import{b as O,a as j}from"./index-Df-EouWY.js";import{i as k}from"./echarts-CAET2t7N.js";import{b as E}from"./@vueuse-DiMacrLm.js";import{_ as w}from"./index-CSmO2_79.js";import{r as y,b as F,D as $,w as z,o as h,c as S,V as n,P as s,a as f,ai as c}from"./@vue-CUOd3UHG.js";import"./axios-BimPEqV4.js";import"./nprogress-DrSneiWl.js";import"./dayjs-DuEr9S7h.js";import"./element-plus-CE7Ada63.js";import"./lodash-es-D0J8aJCM.js";import"./@element-plus-BLrBwQOY.js";import"./@popperjs-CsO2-mKt.js";import"./@ctrl-r5W6hzzQ.js";import"./async-validator-BTg-XjMW.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./@floating-ui-fabFPCLu.js";import"./tslib-BDyQ-Jie.js";import"./zrender-B5ljRYTo.js";import"./pinia-BJVifBRz.js";import"./vue-router-CnFn8NvA.js";import"./pinia-plugin-persistedstate-Bts6f1YT.js";const I={class:"card-container"},x={__name:"ServiceTopologyDiagram",props:{namespace:String},setup(_){const d=_,g=y([]),m=y([]),t=async()=>{const e=await O(d.namespace),i=e.result.nodes;g.value=i.map(a=>a.nodeObject!==null?{draggable:!0,name:a.nodeObject.name,category:a.nodeObject.status?0:1,symbolSize:[50,50],item:a,itemStyle:{color:a.nodeObject.status?"#6EF780":"#FF2700"}}:null);const p=e.result.calls;m.value=p.map(a=>a.source===null||a.target===null?null:{source:a.source.nodeObject.name,target:a.target.nodeObject.name})};let l;F(async()=>{await t(),v(),window.addEventListener("resize",u),l=new ResizeObserver(()=>u),l.observe(document.getElementById("service-topology-dom"))}),$(()=>{window.removeEventListener("resize",u),l.disconnect()});let o;const r=E("theme-appearance","auto");function b(e){const i=e.status?"\u6B63\u5E38":"\u5F02\u5E38\u6216\u79BB\u7EBF",p=e.tags.length===0?"[]":JSON.stringify(e.tags);return`<div>
                    <div>
                        <b>\u5F53\u524DService\u8BE6\u7EC6\u60C5\u51B5</b>
                    </div>
                    <ul>
                        <li>id: ${e.id}</li>
                        <li>\u540D\u79F0: ${e.name}</li>
                        <li>\u547D\u540D\u7A7A\u95F4: ${e.namespace}</li>
                        <li>\u5EF6\u8FDF: ${e.latency} ms</li>
                        <li>\u72B6\u6001: ${i}</li>
                        <li>\u6807\u7B7E: ${p}</li>
                    </ul>
                </div>`}const v=()=>{o&&o.dispose();let e={backgroundColor:r.value==="dark"?"#212224":"#fff",title:{text:"\u670D\u52A1\u5173\u7CFB\u56FE"},legend:{},tooltip:{trigger:"item",triggerOn:"mousemove",backgroundColor:r.value==="dark"?"#212224":"#fff",textStyle:{color:r.value==="dark"?"#fff":"#212224"},formatter:function(i){return b(i.data.item.nodeObject)}},label:{normal:{show:!0,position:"inside"}},series:[{type:"graph",edgeSymbol:["none","arrow"],focusNodeAdjacency:!0,roam:!0,layout:"force",symbol:"circle",data:g.value,links:m.value,label:{normal:{show:!0,position:"inside"}},force:{repulsion:200,edgeLength:100,layoutAnimation:!0},animationEasingUpdate:"quinticInOut",animationDurationUpdate:100,categories:[{name:"\u670D\u52A1\u5728\u7EBF",itemStyle:{color:"#6EF780"}},{name:"\u670D\u52A1\u79BB\u7EBF\u6216\u72B6\u6001\u672A\u77E5",itemStyle:{color:"#FF2700"}}]}]};o=k(document.getElementById("service-topology-dom"),r.value==="dark"?"dark":"light"),o.setOption(e)},u=()=>{o&&o.resize()};return z(r,()=>{v()}),(e,i)=>{const p=c("el-card");return h(),S("div",I,[n(p,null,{default:s(()=>i[0]||(i[0]=[f("div",{id:"service-topology-dom"},null,-1)])),_:1})])}}},T=w(x,[["__scopeId","data-v-0669d9de"]]),V={class:"topology-container"},A={class:"search-bar"},B={__name:"ServiceTopology",setup(_){const d=y(""),g=async(m,t)=>{const l=await j(m);if(l===null)return;const o=l.result.map(r=>({value:r}));t(o)};return(m,t)=>{const l=c("el-breadcrumb-item"),o=c("el-breadcrumb"),r=c("el-row"),b=c("Filter"),v=c("el-icon"),u=c("el-autocomplete");return h(),S("div",V,[n(r,null,{default:s(()=>[n(o,{"separator-icon":"ArrowRight"},{default:s(()=>[n(l,null,{default:s(()=>t[1]||(t[1]=[f("a",{href:"/main"},"\u4E3B\u9875",-1)])),_:1}),n(l,null,{default:s(()=>t[2]||(t[2]=[f("a",{href:"/main/topology"},"\u670D\u52A1\u62D3\u6251",-1)])),_:1})]),_:1})]),_:1}),f("div",A,[n(u,{class:"auto-complete-input",modelValue:d.value,"onUpdate:modelValue":t[0]||(t[0]=e=>d.value=e),"fetch-suggestions":g,clearable:"",placeholder:"\u8BF7\u9009\u62E9\u547D\u540D\u7A7A\u95F4--\u9ED8\u8BA4\u4E3Adefault",onSelect:m.getTopology,style:{width:"40%"}},{prepend:s(()=>[n(v,null,{default:s(()=>[n(b)]),_:1})]),_:1},8,["modelValue","onSelect"])]),n(T,{namespace:d.value},null,8,["namespace"])])}}},C=w(B,[["__scopeId","data-v-abe8eebd"]]);export{C as default};
