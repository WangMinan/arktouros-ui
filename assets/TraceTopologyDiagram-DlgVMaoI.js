import{_ as f}from"./index-Biq-Jgpv.js";import{E as i}from"./element-plus-CB4diBvn.js";import{b}from"./@vueuse-BK87aVxb.js";import{t as $}from"./dateUtil-NlCD2qvi.js";import{i as S}from"./echarts-BIEvihnk.js";import{_ as w}from"./index-BcRlvdM9.js";import{r as N,ad as h,w as I,b as k,W as z,o as _,c as x}from"./@vue-DJGElsCt.js";const A=async t=>{try{const{data:a}=await f.get("/trace/endPoints",{params:{serviceName:t.serviceName,pageNum:t.pageNum,pageSize:t.pageSize,startTimestamp:t.startTimestamp,endTimestamp:t.endTimestamp}});return a.code!==null&&a.code===2e3?a:a.code!==null?(i.error(`\u83B7\u53D6traceId\u8868\u5931\u8D25, ${a.message}`),null):(i.error("\u83B7\u53D6traceId\u8868\u5931\u8D25"),null)}catch(a){i.error(`\u83B7\u53D6traceId\u8868\u5931\u8D25, ${a.message}`)}return null},C=async(t,a,s,c,m)=>{try{const{data:r}=await f.get("/trace/topology",{params:{traceId:t,serviceName:a,innerService:s,startTimestamp:c,stopTimestamp:m}});return r.code!==null&&r.code===2e3?r:r.code!==null?(i.error(`\u83B7\u53D6trace\u4E0B\u62D3\u6251\u5931\u8D25, ${r.message}`),null):(i.error("\u83B7\u53D6trace\u4E0B\u62D3\u6251\u5931\u8D25"),null)}catch(r){i.error(`\u83B7\u53D6trace\u4E0B\u62D3\u6251\u5931\u8D25, ${r.message}`)}return null},D=async()=>{try{const{data:t}=await f.delete("/trace/spans");return t.code!==null&&t.code===2e3?t:t.code!==null?(i.error(`\u5220\u9664\u6240\u6709span\u5931\u8D25, ${t.message}`),null):(i.error("\u5220\u9664\u6240\u6709span\u5931\u8D25"),null)}catch(t){i.error(`\u5220\u9664\u6240\u6709span\u5931\u8D25, ${t.message}`)}return null},B={id:"trace-topology-div"},O={__name:"TraceTopologyDiagram",props:{serviceName:Array},setup(t,{expose:a}){const s=N({name:"",value:"",collapsed:!1,children:[]}),c=t,{serviceName:m}=h(c),r=async(o,e,g,v)=>{if(o===""||o===void 0)return;const d=await C(o,m.value[1],e,g,v);d!==null&&(s.value=d.result,y())};let n;const l=b("theme-appearance","auto");I(l,()=>{y()}),a({getTopology:r,disposeSpanTopology:()=>{n&&n.dispose()}});let p;k(()=>{window.addEventListener("resize",u),p=new ResizeObserver(()=>u),p.observe(document.getElementById("trace-topology-div"))}),z(()=>{window.removeEventListener("resize",u),p.disconnect()});const u=()=>{n&&n.resize()};function E(o){const e=o.data.span,g=o.color==="#FFEE00"?"\u5F02\u5E38":"\u6B63\u5E38",v=$(e.startTime),d=e.endTime==="-1"?"\u8BE5Span\u8D85\u65F6":$(e.endTime),T=e.localEndPoint.ip===""?"null":e.localEndPoint.ip,P=e.remoteEndPoint.ip===""?"null":e.remoteEndPoint.ip;return`<div>
                    <div>
                        <b>\u5F53\u524DSpan\u8BE6\u7EC6\u60C5\u51B5</b>
                    </div>
                    <ul>
                        <li>id: ${e.id}</li>
                        <li>\u540D\u79F0: ${e.name}</li>
                        <li>\u6240\u5C5E\u670D\u52A1: ${e.serviceName}</li>
                        <li>\u5F00\u59CB\u65F6\u95F4: ${v}</li>
                        <li>\u7ED3\u675F\u65F6\u95F4: ${d}</li>
                        <li>span\u72B6\u6001: ${g}</li>
                        <li>\u7236\u8282\u70B9SpanId: ${e.parentSpanId}</li>
                        <li>\u6240\u5C5EendPoint: ${e.localEndPoint.serviceName}</li>
                        <li>\u6240\u5C5EendPoint ip\u4E0E\u7AEF\u53E3: ${T}:${e.localEndPoint.port}</li>
                        <li>\u8FDC\u7A0BendPoint: ${e.remoteEndPoint.serviceName}</li>
                        <li>\u8FDC\u7A0BendPoint ip\u4E0E\u7AEF\u53E3: ${P}:${e.remoteEndPoint.port}</li>
                    </ul>
                </div>`}const y=()=>{n&&n.dispose();let o={title:{subtext:"\u7EFF\u8272\u4E3A\u6B63\u5E38Span\u8282\u70B9\uFF0C\u7EA2\u8272\u4E3A\u5F02\u5E38Span\u8282\u70B9",align:"right"},backgroundColor:l.value==="dark"?"#212224":"#fff",tooltip:{trigger:"item",triggerOn:"mousemove",backgroundColor:l.value==="dark"?"#212224":"#fff",textStyle:{color:l.value==="dark"?"#fff":"#212224"},formatter:function(e){return E(e)}},series:[{type:"tree",symbol:"circle",roam:!0,expandAndCollapse:!0,animationDuration:550,animationDurationUpdate:750,label:{position:"right",verticalAlign:"middle",fontSize:12},initialTreeDepth:-1,data:[s.value]}]};n=S(document.getElementById("trace-topology-div"),l.value==="dark"?"dark":"light"),n.setOption(o)};return(o,e)=>(_(),x("div",B))}},F=w(O,[["__scopeId","data-v-6b31337f"]]);export{F as T,D as d,A as g};
