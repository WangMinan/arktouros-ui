import{b as y}from"./index-BGssWMCn.js";import{i as f}from"./echarts-BRPGUpj0.js";import{b as S}from"./@vueuse-CILSd3tp.js";import{_ as O}from"./index-B3diYfSs.js";import{r as g,b as w,D as h,w as j,o as k,c as z,V as E,P as F,a as L,ai as N}from"./@vue-DII_T4uN.js";const _={class:"card-container"},$={__name:"ServiceTopologyDiagram",props:{namespace:String,symbolSize:Number,repulsion:Number,edgeLength:Number},setup(p,{expose:b}){const n=p,c=g([]),m=g([]),d=async()=>{const e=await y(n.namespace),o=e.result.nodes;c.value=o.map(t=>t.nodeObject!==null?{draggable:!0,name:t.nodeObject.name,category:t.nodeObject.status?0:1,symbolSize:[n.symbolSize,n.symbolSize],item:t,itemStyle:{color:t.nodeObject.status?"#6EF780":"#FF2700"}}:null);const l=e.result.calls;m.value=l.map(t=>t.source===null||t.target===null?null:{source:t.source.nodeObject.name,target:t.target.nodeObject.name})};b({getTopology:d});let r;w(async()=>{await d(),u(),window.addEventListener("resize",s),r=new ResizeObserver(()=>s),r.observe(document.getElementById("service-topology-dom"))}),h(()=>{window.removeEventListener("resize",s),r.disconnect()});let a;const i=S("theme-appearance","auto");function v(e){const o=e.status?"\u6B63\u5E38":"\u5F02\u5E38\u6216\u79BB\u7EBF",l=e.tags.length===0?"[]":JSON.stringify(e.tags);return`<div>
                    <div>
                        <b>\u5F53\u524DService\u8BE6\u7EC6\u60C5\u51B5</b>
                    </div>
                    <ul>
                        <li>id: ${e.id}</li>
                        <li>\u540D\u79F0: ${e.name}</li>
                        <li>\u547D\u540D\u7A7A\u95F4: ${e.namespace}</li>
                        <li>\u5EF6\u8FDF: ${e.latency} ms</li>
                        <li>\u72B6\u6001: ${o}</li>
                        <li>\u6807\u7B7E: ${l}</li>
                    </ul>
                </div>`}const u=()=>{a&&a.dispose();let e={backgroundColor:i.value==="dark"?"#212224":"#fff",title:{text:"\u670D\u52A1\u5173\u7CFB\u56FE"},legend:{},tooltip:{trigger:"item",triggerOn:"mousemove",backgroundColor:i.value==="dark"?"#212224":"#fff",textStyle:{color:i.value==="dark"?"#fff":"#212224"},formatter:function(o){return v(o.data.item.nodeObject)}},label:{normal:{show:!0,position:"inside"}},series:[{type:"graph",edgeSymbol:["none","arrow"],focusNodeAdjacency:!0,roam:!0,layout:"force",symbol:"circle",data:c.value,links:m.value,label:{normal:{show:!0,position:"inside"}},force:{repulsion:n.repulsion,edgeLength:n.edgeLength,layoutAnimation:!0},animationEasingUpdate:"quinticInOut",animationDurationUpdate:100,categories:[{name:"\u670D\u52A1\u5728\u7EBF",itemStyle:{color:"#6EF780"}},{name:"\u670D\u52A1\u79BB\u7EBF\u6216\u72B6\u6001\u672A\u77E5",itemStyle:{color:"#FF2700"}}]}]};a=f(document.getElementById("service-topology-dom"),i.value==="dark"?"dark":"light"),a.setOption(e)},s=()=>{a&&a.resize()};return j(i,()=>{u()}),(e,o)=>{const l=N("el-card");return k(),z("div",_,[E(l,null,{default:F(()=>o[0]||(o[0]=[L("div",{id:"service-topology-dom"},null,-1)])),_:1})])}}},x=O($,[["__scopeId","data-v-34754169"]]);export{x as S};
