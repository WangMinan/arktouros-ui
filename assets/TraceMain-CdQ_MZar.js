import{a as G,g as H}from"./index-BGssWMCn.js";import{g as J,T as K}from"./TraceTopologyDiagram-Dej7IyKa.js";import{u as Q}from"./vue-router-CFABUcc1.js";import{_ as W}from"./index-B3diYfSs.js";import{r as c,Z as R,b as X,c as C,V as a,P as l,ai as t,o as S,a as p,F as Y,a8 as $,u as ee,O as ae}from"./@vue-DII_T4uN.js";import"./axios-CCb-kr4I.js";import"./nprogress-DrSneiWl.js";import"./dayjs-DuEr9S7h.js";import"./arktourosUiConfigUtil-DM9bp1OR.js";import"./element-plus-DzYaY9yg.js";import"./lodash-es-D0J8aJCM.js";import"./@element-plus-Dylqen5s.js";import"./@popperjs-CsO2-mKt.js";import"./@ctrl-r5W6hzzQ.js";import"./async-validator-BTg-XjMW.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./@floating-ui-fabFPCLu.js";import"./@vueuse-CILSd3tp.js";import"./dateUtil-NlCD2qvi.js";import"./echarts-BRPGUpj0.js";import"./tslib-BDyQ-Jie.js";import"./zrender-UROijHWN.js";import"./pinia-BJhnWFyR.js";import"./pinia-plugin-persistedstate-Bts6f1YT.js";const le={class:"trace-main-container"},te={class:"cascader-div"},re={class:"endpoint-div"},ue={class:"table-div"},oe={class:"pagination-div"},ie={__name:"TraceMain",setup(se){const N=c(!0),f=c(),i=Q(),T=R({lazy:!0,async lazyLoad(u,e){const v=[],{level:w}=u;if(w===0){const s=await G();if(s===null)return;s.result.map(o=>({leaf:!1,value:o,label:o})).forEach(o=>{v.push(o)})}else if(w===1){const s=await H({query:"",namespace:u.value,pageNum:1,pageSize:1e3});if(s===null)return;s.result.data.map(o=>({leaf:!0,value:o.name,label:o.name===""?"null":o.name})).forEach(o=>{v.push(o)})}e(v)}}),n=R({serviceName:"",pageNum:1,pageSize:10}),y=c(),g=c("");X(async()=>{i.currentRoute.value.query.serviceName&&(n.serviceName=i.currentRoute.value.query.serviceName,f.value=["default",i.currentRoute.value.query.serviceName],await b()),i.currentRoute.value.query.traceId&&(d.value.includes(i.currentRoute.value.query.traceId)||d.value.push(i.currentRoute.value.query.traceId),g.value=i.currentRoute.value.query.traceId),i.currentRoute.value.query.serviceName&&i.currentRoute.value.query.traceId&&await y.value.getTopology()});const I=c(0),b=async()=>{m.value.splice(0,m.value.length),_.splice(0,_.length),I.value=0,y.value.disposeSpanTopology(),d.value=[],g.value="",n.serviceName=f.value[1];const u=await J(n);u===null||u.result.length===0||(I.value=u.result.length,u.result.forEach(e=>{m.value.push(e)}),m.value.forEach(e=>{_.push(e.endPoint)}),d.value=m.value[0].traceIds)};let d=c([]);const m=c([{endPoint:{},traceIds:[]}]),_=R([]),E=async u=>{n.pageSize=u,await b()},P=async u=>{n.pageNum=u,await b()},x=u=>{m.value.forEach(e=>{e.endPoint===u&&(d.value=e.traceIds)})},q=async()=>{await y.value.getTopology(g.value)};return(u,e)=>{const v=t("el-breadcrumb-item"),w=t("el-breadcrumb"),s=t("el-row"),o=t("el-cascader"),U=t("el-divider"),h=t("el-table-column"),k=t("ArrowRightBold"),A=t("el-icon"),B=t("el-button"),D=t("el-tooltip"),F=t("el-table"),L=t("el-pagination"),z=t("el-col"),M=t("el-option"),O=t("el-select"),V=t("el-form-item"),Z=t("el-switch"),j=t("el-card");return S(),C("div",le,[a(s,null,{default:l(()=>[a(w,{"separator-icon":"ArrowRight"},{default:l(()=>[a(v,null,{default:l(()=>e[7]||(e[7]=[p("a",{href:"/main"},"\u4E3B\u9875",-1)])),_:1}),a(v,null,{default:l(()=>e[8]||(e[8]=[p("a",{href:"/main/trace"},"\u94FE\u8DEF\u4FE1\u606F",-1)])),_:1})]),_:1})]),_:1}),a(j,{class:"table-card"},{default:l(()=>[p("div",te,[a(o,{placeholder:"\u8BF7\u9009\u62E9\u5BF9\u5E94\u670D\u52A1",modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=r=>f.value=r),style:{width:"40%"},clearable:"",props:T,"show-all-levels":!1,onChange:b},null,8,["modelValue","props"])]),a(U),a(s,{gutter:10,style:{"margin-top":"2%"}},{default:l(()=>[a(z,{span:8},{default:l(()=>[e[9]||(e[9]=p("div",null,"\u8FFD\u8E2A\u7AEF\u70B9\u4FE1\u606F",-1)),p("div",re,[p("div",ue,[a(F,{data:_,stripe:""},{default:l(()=>[a(h,{prop:"serviceName",label:"\u670D\u52A1\u540D\u79F0"}),a(h,{prop:"ip",label:"IP\u5730\u5740"}),a(h,{prop:"port",label:"\u7AEF\u53E3\u53F7"}),a(h,{prop:"latency",label:"\u65F6\u5EF6"}),a(h,{fixed:"right",label:"\u7ED8\u56FE"},{default:l(r=>[a(D,{effect:"light",content:"\u67E5\u770BEndpoint\u6240\u5728\u94FE\u8DEF\u4FE1\u606F",placement:"top",enterable:!1},{default:l(()=>[a(B,{type:"primary",circle:"",size:"small",onClick:pe=>x(r.row)},{default:l(()=>[a(A,null,{default:l(()=>[a(k)]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])]),p("div",oe,[a(L,{"current-page":n.pageNum,"onUpdate:currentPage":e[1]||(e[1]=r=>n.pageNum=r),"page-size":n.pageSize,"onUpdate:pageSize":e[2]||(e[2]=r=>n.pageSize=r),"page-sizes":[2,5,10,20],layout:"total, pager, sizes",total:I.value,"pager-count":5,onSizeChange:E,onCurrentChange:P},null,8,["current-page","page-size","total"])])])]),_:1}),a(z,{span:16},{default:l(()=>[p("div",null,[e[10]||(e[10]=p("div",null,"Span\u8C03\u7528\u56FE",-1)),a(s,{gutter:15},{default:l(()=>[a(z,{span:12},{default:l(()=>[a(V,{label:"TraceId"},{default:l(()=>[a(O,{modelValue:g.value,"onUpdate:modelValue":e[3]||(e[3]=r=>g.value=r),placeholder:"\u8BF7\u5728\u5DE6\u4FA7\u9009\u62E9Endpoint\u540E\uFF0C\u9009\u62E9TraceId",style:{width:"90%"},clearable:"",onChange:e[4]||(e[4]=r=>q())},{default:l(()=>[(S(!0),C(Y,null,$(ee(d),r=>(S(),ae(M,{key:r,label:r,value:r},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(z,{span:12},{default:l(()=>[a(V,null,{default:l(()=>[a(Z,{"active-text":"\u4EC5\u67E5\u770B\u5C5E\u4E8E\u5F53\u524Dservice\u7684span","inactive-text":"\u67E5\u770B\u5F53\u524Dtrace\u4E0B\u7684\u6240\u6709span",modelValue:N.value,"onUpdate:modelValue":e[5]||(e[5]=r=>N.value=r),size:"small",onChange:e[6]||(e[6]=r=>q())},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),a(K,{ref_key:"traceTopologyDiagramRef",ref:y,serviceName:f.value,innerService:N.value},null,8,["serviceName","innerService"])]),_:1})]),_:1})]),_:1})])}}},ne=W(ie,[["__scopeId","data-v-4af61bdb"]]);export{ne as default};
