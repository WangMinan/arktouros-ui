import{_ as m}from"./index-BDiRKEvP.js";import{E as n}from"./element-plus-JR2pXvE7.js";import{b as N}from"./@vueuse-1qkZ0HVG.js";import{t as u}from"./dateUtil-NlCD2qvi.js";import{i as T}from"./echarts-BRPGUpj0.js";import{_ as I}from"./index-B5yo7kJO.js";import{r as h,_ as v,w,b as k,D as z,o as _,c as x}from"./@vue-BYRy83j1.js";const D=async o=>{try{const{data:t}=await m.get("/trace/endPoints",{params:{serviceName:o.serviceName,pageNum:o.pageNum,pageSize:o.pageSize}});return t.code!==null&&t.code===2e3?t:t.code!==null?(n.error(`\u83B7\u53D6traceId\u8868\u5931\u8D25, ${t.message}`),null):(n.error("\u83B7\u53D6traceId\u8868\u5931\u8D25"),null)}catch(t){n.error(`\u83B7\u53D6traceId\u8868\u5931\u8D25, ${t.message}`)}return null},A=async(o,t,s)=>{try{const{data:r}=await m.get("/trace/topology",{params:{traceId:o,serviceName:t,innerService:s}});return r.code!==null&&r.code===2e3?r:r.code!==null?(n.error(`\u83B7\u53D6trace\u4E0B\u62D3\u6251\u5931\u8D25, ${r.message}`),null):(n.error("\u83B7\u53D6trace\u4E0B\u62D3\u6251\u5931\u8D25"),null)}catch(r){n.error(`\u83B7\u53D6trace\u4E0B\u62D3\u6251\u5931\u8D25, ${r.message}`)}return null},B={id:"trace-topology-div"},C={__name:"TraceTopologyDiagram",props:{serviceName:Array,innerService:Boolean},setup(o,{expose:t}){const s=h({name:"",value:"",collapsed:!1,children:[]}),r=o,{serviceName:g}=v(r),{innerService:f}=v(r),y=async e=>{if(e===""||e===void 0)return;const i=await A(e,g.value[1],f.value);i!==null&&(s.value=i.result,p())};let a;const l=N("theme-appearance","auto");w(l,()=>{p()}),t({getTopology:y,disposeSpanTopology:()=>{a&&a.dispose()}});let d;k(()=>{window.addEventListener("resize",c),d=new ResizeObserver(()=>c),d.observe(document.getElementById("trace-topology-div"))}),z(()=>{window.removeEventListener("resize",c),d.disconnect()});const c=()=>{a&&a.resize()};function $(e){const i=e.endTime==="-1"?"\u5F02\u5E38\u6216\u79BB\u7EBF":"\u6B63\u5E38",S=u(e.startTime),E=e.endTime==="-1"?"\u8BE5Span\u5F02\u5E38":u(e.endTime),P=e.localEndPoint.ip===""?"null":e.localEndPoint.ip,b=e.remoteEndPoint.ip===""?"null":e.remoteEndPoint.ip;return`<div>
                    <div>
                        <b>\u5F53\u524DSpan\u8BE6\u7EC6\u60C5\u51B5</b>
                    </div>
                    <ul>
                        <li>id: ${e.id}</li>
                        <li>\u540D\u79F0: ${e.name}</li>
                        <li>\u6240\u5C5E\u670D\u52A1: ${e.serviceName}</li>
                        <li>\u5F00\u59CB\u65F6\u95F4: ${S}</li>
                        <li>\u7ED3\u675F\u65F6\u95F4: ${E}</li>
                        <li>span\u72B6\u6001: ${i}</li>
                        <li>\u7236\u8282\u70B9SpanId: ${e.parentSpanId}</li>
                        <li>\u6240\u5C5EendPoint: ${e.localEndPoint.serviceName}</li>
                        <li>\u6240\u5C5EendPoint ip\u4E0E\u7AEF\u53E3: ${P}:${e.localEndPoint.port}</li>
                        <li>\u8FDC\u7A0BendPoint: ${e.remoteEndPoint.serviceName}</li>
                        <li>\u8FDC\u7A0BendPoint ip\u4E0E\u7AEF\u53E3: ${b}:${e.remoteEndPoint.port}</li>
                    </ul>
                </div>`}const p=()=>{a&&a.dispose();let e={title:{subtext:"\u7EFF\u8272\u4E3A\u6B63\u5E38Span\u8282\u70B9\uFF0C\u7EA2\u8272\u4E3A\u5F02\u5E38Span\u8282\u70B9",align:"right"},backgroundColor:l.value==="dark"?"#212224":"#fff",tooltip:{trigger:"item",triggerOn:"mousemove",backgroundColor:l.value==="dark"?"#212224":"#fff",textStyle:{color:l.value==="dark"?"#fff":"#212224"},formatter:function(i){return $(i.data.span)}},series:[{type:"tree",symbol:"circle",roam:!0,expandAndCollapse:!0,animationDuration:550,animationDurationUpdate:750,label:{position:"right",verticalAlign:"middle",fontSize:9},initialTreeDepth:-1,data:[s.value]}]};a=T(document.getElementById("trace-topology-div"),l.value==="dark"?"dark":"light"),a.setOption(e)};return(e,i)=>(_(),x("div",B))}},O=I(C,[["__scopeId","data-v-427ee9ab"]]);export{O as T,D as g};
