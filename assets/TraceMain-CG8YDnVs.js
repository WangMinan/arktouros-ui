import{a as J,g as K}from"./index-B2Kl2G0a.js";import{g as O,T as W,d as Y}from"./TraceTopologyDiagram-IaDyH_AQ.js";import{u as Z}from"./vue-router-Bu4PTcIf.js";import{_ as $}from"./index-BKE5u5tY.js";import{a as ee,E as ae}from"./element-plus-CB4diBvn.js";import{r as p,X as C,b as le,c as T,Q as a,I as l,ag as t,o as S,a as n,M as N,P as te,a4 as re,u as ue,H as oe}from"./@vue-DJGElsCt.js";import"./axios-upsvKRUO.js";import"./nprogress-vyVW41Zc.js";import"./dayjs-DUzyJfMy.js";import"./arktourosUiConfigUtil-DM9bp1OR.js";import"./@vueuse-BK87aVxb.js";import"./dateUtil-NlCD2qvi.js";import"./echarts-BIEvihnk.js";import"./tslib-BDyQ-Jie.js";import"./zrender-CdholsD1.js";import"./pinia-C1gkOLtH.js";import"./@element-plus-dQIYR_U6.js";import"./pinia-plugin-persistedstate-BlIkimV0.js";import"./destr-Cx7WjB9q.js";import"./deep-pick-omit-B1UrSIxj.js";import"./lodash-es-BKnOc8U_.js";import"./@popperjs-Bm-vPkQ2.js";import"./@ctrl-CBTFr1m8.js";import"./async-validator-DBBz-maN.js";import"./memoize-one-DxrTgWdQ.js";import"./normalize-wheel-es-Cg1Do7zv.js";import"./@floating-ui-BPK96wVr.js";const ne={class:"trace-main-container"},ie={class:"cascader-div"},se={class:"endpoint-div"},ce={class:"table-div"},pe={class:"pagination-div"},de={__name:"TraceMain",setup(ve){const I=p(!0),f=p(),i=Z(),k=C({lazy:!0,async lazyLoad(u,e){const v=[],{level:w}=u;if(w===0){const c=await J();if(c===null)return;c.result.map(o=>({leaf:!1,value:o,label:o})).forEach(o=>{v.push(o)})}else if(w===1){const c=await K({query:"",namespace:u.value,pageNum:1,pageSize:1e3});if(c===null)return;c.result.data.map(o=>({leaf:!0,value:o.name,label:o.name===""?"null":o.name})).forEach(o=>{v.push(o)})}e(v)}}),s=C({serviceName:"",pageNum:1,pageSize:10}),h=p(),g=p("");le(async()=>{i.currentRoute.value.query.serviceName&&(s.serviceName=i.currentRoute.value.query.serviceName,f.value=["default",i.currentRoute.value.query.serviceName],await b()),i.currentRoute.value.query.traceId&&(d.value.includes(i.currentRoute.value.query.traceId)||d.value.push(i.currentRoute.value.query.traceId),g.value=i.currentRoute.value.query.traceId),i.currentRoute.value.query.serviceName&&i.currentRoute.value.query.traceId&&await h.value.getTopology()});const R=p(0),b=async()=>{m.value.splice(0,m.value.length),_.splice(0,_.length),R.value=0,h.value.disposeSpanTopology(),d.value=[],g.value="",s.serviceName=f.value[1];const u=await O(s);u===null||u.result.length===0||(R.value=u.result.length,u.result.forEach(e=>{m.value.push(e)}),m.value.forEach(e=>{_.push(e.endPoint)}),d.value=m.value[0].traceIds)};let d=p([]);const m=p([{endPoint:{},traceIds:[]}]),_=C([]),P=async u=>{s.pageSize=u,await b()},x=async u=>{s.pageNum=u,await b()},U=u=>{m.value.forEach(e=>{e.endPoint===u&&(d.value=e.traceIds)})},V=async()=>{await h.value.getTopology(g.value,I.value)},A=async()=>{const u=ee.service({lock:!0,text:"\u6B63\u5728\u6267\u884C\u6570\u636E\u8FD0\u7EF4\u64CD\u4F5C\uFF0C\u8BF7\u7B49\u5F85\u3002",background:"rgba(0, 0, 0, 0.7)"});try{const e=await Y();if(e===null||e.result.length===0)return;ae.success("\u5220\u9664\u6240\u6709\u94FE\u8DEF\u6570\u636E\u6210\u529F")}finally{u.close(),i.go(0)}};return(u,e)=>{const v=t("el-breadcrumb-item"),w=t("el-breadcrumb"),c=t("el-button"),o=t("el-tooltip"),q=t("el-row"),M=t("el-cascader"),B=t("el-divider"),y=t("el-table-column"),D=t("ArrowRightBold"),F=t("el-icon"),H=t("el-table"),L=t("el-pagination"),z=t("el-col"),Q=t("el-option"),X=t("el-select"),E=t("el-form-item"),j=t("el-switch"),G=t("el-card");return S(),T("div",ne,[a(q,{class:"breadcrumb-header-row"},{default:l(()=>[a(w,{"separator-icon":"ArrowRight"},{default:l(()=>[a(v,null,{default:l(()=>e[7]||(e[7]=[n("a",{href:"/main"},"\u4E3B\u9875",-1)])),_:1}),a(v,null,{default:l(()=>e[8]||(e[8]=[n("a",{href:"/main/trace"},"\u94FE\u8DEF\u4FE1\u606F",-1)])),_:1})]),_:1}),a(o,{placement:"bottom"},{content:l(()=>e[9]||(e[9]=[N(" \u70B9\u51FB\u8BE5\u6309\u94AE\u5C06\u4F1A"),n("b",{style:{color:"red"}},"\u5220\u9664\u6240\u6709\u94FE\u8DEF\u6570\u636E",-1),N("\uFF0C\u8BF7\u786E\u4FDD\u60A8\u77E5\u6653\u8BE5\u64CD\u4F5C\u5C06\u5E26\u6765\u7684\u540E\u679C\u3002 "),n("br",null,null,-1),N(" \u5220\u9664\u64CD\u4F5C\u5C06\u9501\u5B9A\u7528\u6237\u754C\u9762\u76F4\u81F3\u5220\u9664\u5B8C\u6210\u3002 ")])),default:l(()=>[a(c,{type:"danger",onClick:A},{default:l(()=>e[10]||(e[10]=[N(" \u5220\u9664\u6240\u6709\u94FE\u8DEF\u6570\u636E ")])),_:1})]),_:1})]),_:1}),a(G,{class:"table-card"},{default:l(()=>[n("div",ie,[a(M,{placeholder:"\u8BF7\u9009\u62E9\u5BF9\u5E94\u670D\u52A1",modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=r=>f.value=r),style:{width:"40%"},clearable:"",props:k,"show-all-levels":!1,onChange:b},null,8,["modelValue","props"])]),a(B),a(q,{gutter:10,style:{"margin-top":"2%"}},{default:l(()=>[a(z,{span:8},{default:l(()=>[e[11]||(e[11]=n("div",null,"\u8FFD\u8E2A\u7AEF\u70B9\u4FE1\u606F",-1)),n("div",se,[n("div",ce,[a(H,{data:_,stripe:""},{default:l(()=>[a(y,{prop:"serviceName",label:"\u670D\u52A1\u540D\u79F0"}),a(y,{prop:"ip",label:"IP\u5730\u5740"}),a(y,{prop:"port",label:"\u7AEF\u53E3\u53F7"}),a(y,{prop:"latency",label:"\u65F6\u5EF6"}),a(y,{fixed:"right",label:"\u7ED8\u56FE"},{default:l(r=>[a(o,{effect:"light",content:"\u67E5\u770BEndpoint\u6240\u5728\u94FE\u8DEF\u4FE1\u606F",placement:"top",enterable:!1},{default:l(()=>[a(c,{type:"primary",circle:"",size:"small",onClick:fe=>U(r.row)},{default:l(()=>[a(F,null,{default:l(()=>[a(D)]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])]),n("div",pe,[a(L,{"current-page":s.pageNum,"onUpdate:currentPage":e[1]||(e[1]=r=>s.pageNum=r),"page-size":s.pageSize,"onUpdate:pageSize":e[2]||(e[2]=r=>s.pageSize=r),"page-sizes":[2,5,10,20],layout:"total, pager, sizes",total:R.value,"pager-count":5,onSizeChange:P,onCurrentChange:x},null,8,["current-page","page-size","total"])])])]),_:1}),a(z,{span:16},{default:l(()=>[n("div",null,[e[12]||(e[12]=n("div",null,"Span\u8C03\u7528\u56FE",-1)),a(q,{gutter:15},{default:l(()=>[a(z,{span:12},{default:l(()=>[a(E,{label:"TraceId"},{default:l(()=>[a(X,{modelValue:g.value,"onUpdate:modelValue":e[3]||(e[3]=r=>g.value=r),placeholder:"\u8BF7\u5728\u5DE6\u4FA7\u9009\u62E9Endpoint\u540E\uFF0C\u9009\u62E9TraceId",style:{width:"90%"},clearable:"",onChange:e[4]||(e[4]=r=>V())},{default:l(()=>[(S(!0),T(te,null,re(ue(d),r=>(S(),oe(Q,{key:r,label:r,value:r},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(z,{span:12},{default:l(()=>[a(E,null,{default:l(()=>[a(j,{"active-text":"\u4EC5\u67E5\u770B\u5C5E\u4E8E\u5F53\u524Dservice\u7684span","inactive-text":"\u67E5\u770B\u5F53\u524Dtrace\u4E0B\u7684\u6240\u6709span",modelValue:I.value,"onUpdate:modelValue":e[5]||(e[5]=r=>I.value=r),size:"small",onChange:e[6]||(e[6]=r=>V())},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),a(W,{ref_key:"traceTopologyDiagramRef",ref:h,serviceName:f.value},null,8,["serviceName"])]),_:1})]),_:1})]),_:1})])}}},me=$(de,[["__scopeId","data-v-4f5483c5"]]);export{me as default};
