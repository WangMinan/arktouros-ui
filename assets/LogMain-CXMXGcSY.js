import{_ as O,a as ee,g as ae}from"./index-BZCjJ8_N.js";import{E as f}from"./element-plus-CE7Ada63.js";import{u as le}from"./vue-router-CnFn8NvA.js";import{t as E}from"./dateUtil-NlCD2qvi.js";import{u as te}from"./index-BEyW8B92.js";import{s as ue}from"./pinia-BDCl_YBC.js";import{_ as re}from"./index-BjjZILM_.js";import{r as g,b as oe,Z as de,c as J,a as b,V as a,P as t,F as A,ai as d,o as U,T as N,a8 as ne,O as se,U as I,u as me}from"./@vue-CUOd3UHG.js";import"./axios-BimPEqV4.js";import"./nprogress-DrSneiWl.js";import"./dayjs-DuEr9S7h.js";import"./lodash-es-D0J8aJCM.js";import"./@element-plus-BLrBwQOY.js";import"./@popperjs-CsO2-mKt.js";import"./@ctrl-r5W6hzzQ.js";import"./async-validator-BTg-XjMW.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./@floating-ui-fabFPCLu.js";import"./pinia-plugin-persistedstate-Bts6f1YT.js";const ie=async i=>{try{const{data:n}=await O.get("/log/levels",{params:{query:i}});return n.code!==null&&n.code===2e3?n:n.code!==null?(f.error(`\u83B7\u53D6\u65E5\u5FD7\u7EA7\u522B\u5217\u8868\u5931\u8D25, ${n.message}`),null):(f.error("\u83B7\u53D6\u65E5\u5FD7\u7EA7\u522B\u5217\u8868\u5931\u8D25"),null)}catch(n){f.error(`\u83B7\u53D6\u65E5\u5FD7\u7EA7\u522B\u5217\u8868\u5931\u8D25, ${n.message}`)}return null},ce=async i=>{try{const{data:n}=await O.get("/logs",{params:{pageNum:i.pageNum,pageSize:i.pageSize,serviceName:i.serviceName,traceId:i.traceId,keyword:i.keyword,keywordNotIncluded:i.keywordNotIncluded,severityText:i.severityText,startTimestamp:i.startTimestamp,endTimestamp:i.endTimestamp}});if(n.code!==null&&n.code===2e3)return n;if(n.code!==null)return f.error(`\u83B7\u53D6\u65E5\u5FD7\u5217\u8868\u5931\u8D25, ${n.message}`),null}catch(n){f.error(`\u83B7\u53D6\u65E5\u5FD7\u5217\u8868\u5931\u8D25, ${n.message}`)}return null},pe={class:"log-main-container"},ve={class:"search-area"},fe={class:"pagination-div"},ge={__name:"LogMain",setup(i){const n=te();ue(n);const D=le(),z=g(0),S=g([]),h=g(),_=g([]),r=g({pageNum:1,pageSize:10,serviceName:"",traceId:"",keyword:"",keywordNotIncluded:"",severityText:"",startTimestamp:0,endTimestamp:0}),w=async()=>{const u=JSON.parse(JSON.stringify(r.value));if(_.value.length===2)u.startTimestamp=Date.parse(_.value[0]),u.endTimestamp=Date.parse(_.value[1]);else{f.warning("\u5F53\u524D\u4E3A\u6B63\u5F0F\u73AF\u5883, \u65F6\u95F4\u8303\u56F4\u7F6E\u7A7A\u65F6\u9ED8\u8BA4\u83B7\u53D6\u8FD1\u534A\u4E2A\u5C0F\u65F6\u5185\u7684\u65E5\u5FD7");const s=new Date;u.startTimestamp=s.getTime()-30*60*1e3,u.endTimestamp=s.getTime()}const e=await ce(u);e!==null&&(z.value=parseInt(e.result.total),e.result.data.forEach(s=>{s.serviceName||(s.serviceName="null")}),S.value=e.result.data)},L=async u=>{r.value.pageSize=u,await w()},q=async u=>{r.value.pageNum=u,await w()},F=async(u,e)=>{const s=await ie(u);if(s===null){e([]);return}const y=s.result.map(p=>p?{value:p}:{value:"null"});e(y)};oe(async()=>{await w()});const T=g(!1),o=g({}),P=u=>{const e=JSON.parse(JSON.stringify(u));o.value=e,o.value.timestamp=E(e.timestamp),o.value.error=e.error?"\u5F02\u5E38":"\u6B63\u5E38",o.value.tags=e.tags.map(s=>s.key+"->"+s.value).join(`
`),T.value=!0},j=async u=>{if(!u.serviceName||!u.traceId){f.warning("\u8BE5\u65E5\u5FD7\u672A\u4E0A\u62A5\u94FE\u8DEF\u4FE1\u606F");return}n.$patch(e=>{e.currentAside.active="/main/trace"}),await D.push(`/main/trace?serviceName=${u.serviceName}&traceId=${u.traceId}`)},M=de({lazy:!0,async lazyLoad(u,e){const s=[],{level:y}=u;if(y===0){const p=await ee();if(p===null)return;p.result.map(c=>({leaf:!1,value:c,label:c})).forEach(c=>{s.push(c)})}else if(y===1){const p=await ae({query:"",namespace:u.value,pageNum:1,pageSize:1e3});if(p===null)return;p.result.data.map(c=>({leaf:!0,value:c.name,label:c.name===""?"null":c.name})).forEach(c=>{s.push(c)})}e(s)}}),Q=()=>{h.value?(r.value.serviceName=h.value[1],(r.value.serviceName===""||r.value.serviceName==null)&&(r.value.serviceName="null")):r.value.serviceName=null};return(u,e)=>{const s=d("el-breadcrumb-item"),y=d("el-breadcrumb"),p=d("el-row"),c=d("el-cascader"),m=d("el-form-item"),v=d("el-input"),R=d("el-date-picker"),Z=d("el-autocomplete"),k=d("el-button"),x=d("el-form"),B=d("el-divider"),V=d("el-col"),G=d("Share"),C=d("el-icon"),$=d("el-tooltip"),H=d("InfoFilled"),K=d("el-pagination"),W=d("el-card"),X=d("el-dialog");return U(),J(A,null,[b("div",pe,[a(p,null,{default:t(()=>[a(y,{"separator-icon":"ArrowRight"},{default:t(()=>[a(s,null,{default:t(()=>e[17]||(e[17]=[b("a",{href:"/main"},"\u4E3B\u9875",-1)])),_:1}),a(s,null,{default:t(()=>e[18]||(e[18]=[b("a",{href:"/main/log"},"\u65E5\u5FD7\u6982\u89C8",-1)])),_:1})]),_:1})]),_:1}),a(W,{class:"log-card"},{default:t(()=>[b("div",ve,[a(x,{inline:!0,model:r.value},{default:t(()=>[a(m,{label:"\u670D\u52A1\u540D\u79F0"},{default:t(()=>[a(c,{placeholder:"\u8BF7\u9009\u62E9\u547D\u540D\u7A7A\u95F4\u2192\u670D\u52A1\u540D\u79F0",modelValue:h.value,"onUpdate:modelValue":e[0]||(e[0]=l=>h.value=l),clearable:"",props:M,"show-all-levels":!1,onChange:Q},null,8,["modelValue","props"])]),_:1}),a(m,{label:"traceId"},{default:t(()=>[a(v,{modelValue:r.value.traceId,"onUpdate:modelValue":e[1]||(e[1]=l=>r.value.traceId=l),placeholder:"\u8BF7\u8F93\u5165\u4E00\u4E2AtraceId",clearable:""},null,8,["modelValue"])]),_:1}),a(m,{label:"\u8D77\u6B62\u65F6\u95F4"},{default:t(()=>[a(R,{modelValue:_.value,"onUpdate:modelValue":e[2]||(e[2]=l=>_.value=l),type:"datetimerange","range-separator":"\u5230","start-placeholder":"\u5F00\u59CB\u65F6\u95F4","end-placeholder":"\u7ED3\u675F\u65F6\u95F4"},null,8,["modelValue"])]),_:1}),a(m,{label:"\u65E5\u5FD7\u7EA7\u522B"},{default:t(()=>[a(Z,{class:"auto-complete-input",modelValue:r.value.severityText,"onUpdate:modelValue":e[3]||(e[3]=l=>r.value.severityText=l),"fetch-suggestions":F,clearable:"",placeholder:"\u8BF7\u8F93\u5165\u65E5\u5FD7\u7EA7\u522B"},null,8,["modelValue"])]),_:1}),a(m,{label:"\u5185\u5BB9\u5173\u952E\u8BCD"},{default:t(()=>[a(v,{modelValue:r.value.keyword,"onUpdate:modelValue":e[4]||(e[4]=l=>r.value.keyword=l),placeholder:"\u8BF7\u8F93\u5165\u4E00\u4E2A\u5185\u5BB9\u5173\u952E\u8BCD",clearable:""},null,8,["modelValue"])]),_:1}),a(m,{label:"\u5185\u5BB9\u4E0D\u5305\u542B\u7684\u5173\u952E\u8BCD"},{default:t(()=>[a(v,{modelValue:r.value.keywordNotIncluded,"onUpdate:modelValue":e[5]||(e[5]=l=>r.value.keywordNotIncluded=l),placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9\u4E0D\u5305\u542B\u7684\u5173\u952E\u8BCD",clearable:""},null,8,["modelValue"])]),_:1}),a(m,null,{default:t(()=>[a(k,{type:"primary",onClick:w},{default:t(()=>e[19]||(e[19]=[N("\u641C\u7D22")])),_:1})]),_:1})]),_:1},8,["model"])]),a(B),(U(!0),J(A,null,ne(S.value,l=>(U(),se(p,{gutter:5,key:l,style:{"word-break":"break-all"}},{default:t(()=>[a(V,{span:4},{default:t(()=>[N(I(l.serviceName),1)]),_:2},1024),a(V,{span:3},{default:t(()=>[N(I(me(E)(l.timestamp)),1)]),_:2},1024),a(V,{span:2},{default:t(()=>[N(I(l.severityText),1)]),_:2},1024),a(V,{span:12},{default:t(()=>[N(I(l.content),1)]),_:2},1024),a(V,{span:1},{default:t(()=>[a($,{effect:"light",content:"\u67E5\u770B\u65E5\u5FD7\u5BF9\u5E94\u94FE\u8DEF\u4FE1\u606F",placement:"top",enterable:!1},{default:t(()=>[a(k,{type:"primary",circle:"",size:"small",onClick:Y=>j(l)},{default:t(()=>[a(C,null,{default:t(()=>[a(G)]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024),a(V,{span:1},{default:t(()=>[a($,{effect:"light",content:"\u67E5\u770B\u65E5\u5FD7\u5177\u4F53\u4FE1\u606F",placement:"top",enterable:!1},{default:t(()=>[a(k,{type:"primary",circle:"",size:"small",onClick:Y=>P(l)},{default:t(()=>[a(C,null,{default:t(()=>[a(H)]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)),b("div",fe,[a(K,{"current-page":r.value.pageNum,"onUpdate:currentPage":e[6]||(e[6]=l=>r.value.pageNum=l),"page-size":r.value.pageSize,"onUpdate:pageSize":e[7]||(e[7]=l=>r.value.pageSize=l),"page-sizes":[2,5,10,20],layout:"total, prev, pager, next, sizes",total:z.value,onSizeChange:L,onCurrentChange:q},null,8,["current-page","page-size","total"])])]),_:1})]),a(X,{modelValue:T.value,"onUpdate:modelValue":e[16]||(e[16]=l=>T.value=l),title:"Log",width:"60%"},{default:t(()=>[a(x,{"label-position":"left","label-width":"auto",model:o.value,disabled:""},{default:t(()=>[a(m,{label:"\u65E5\u5FD7\u65F6\u95F4"},{default:t(()=>[a(v,{modelValue:o.value.timestamp,"onUpdate:modelValue":e[8]||(e[8]=l=>o.value.timestamp=l)},null,8,["modelValue"])]),_:1}),a(m,{label:"\u65E5\u5FD7\u7EA7\u522B"},{default:t(()=>[a(v,{modelValue:o.value.severityText,"onUpdate:modelValue":e[9]||(e[9]=l=>o.value.severityText=l)},null,8,["modelValue"])]),_:1}),a(m,{label:"\u65E5\u5FD7\u5185\u5BB9"},{default:t(()=>[a(v,{type:"textarea",modelValue:o.value.content,"onUpdate:modelValue":e[10]||(e[10]=l=>o.value.content=l)},null,8,["modelValue"])]),_:1}),a(m,{label:"\u670D\u52A1\u540D\u79F0"},{default:t(()=>[a(v,{modelValue:o.value.serviceName,"onUpdate:modelValue":e[11]||(e[11]=l=>o.value.serviceName=l)},null,8,["modelValue"])]),_:1}),a(m,{label:"\u8FFD\u8E2AId"},{default:t(()=>[a(v,{modelValue:o.value.traceId,"onUpdate:modelValue":e[12]||(e[12]=l=>o.value.traceId=l)},null,8,["modelValue"])]),_:1}),a(m,{label:"SpanId"},{default:t(()=>[a(v,{modelValue:o.value.spanId,"onUpdate:modelValue":e[13]||(e[13]=l=>o.value.spanId=l)},null,8,["modelValue"])]),_:1}),a(m,{label:"\u72B6\u6001"},{default:t(()=>[a(v,{modelValue:o.value.error,"onUpdate:modelValue":e[14]||(e[14]=l=>o.value.error=l)},null,8,["modelValue"])]),_:1}),a(m,{label:"Tags"},{default:t(()=>[a(v,{type:"textarea",rows:3,modelValue:o.value.tags,"onUpdate:modelValue":e[15]||(e[15]=l=>o.value.tags=l)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}},ye=re(ge,[["__scopeId","data-v-e3dc30ac"]]);export{ye as default};
